@startuml diagrammeAll
skinparam classAttributeIconSize 0

!include diagrammeFlow.txt!0
 
Flow --> "1" PipeManager

class PipeManager {
  -no_workers: int

  addStage(): void
  nbWorkers(): int
  setNbWorkers(): void
  isParallel(): bool
  run(): void
} 

PipeManager --> "stages\n0..*" Stage

PipeManager -> "1" Pipeline

class Pipeline {
  addStage(): void
  run(): void
}

Pipeline --|> Node
Farm --|> Node
Worker --|> Node

class Farm {
  nbWorkers(): int
  addStage(): void
}

Farm --> "1..*" Worker
Farm --> ff_farm

class Worker {
}

class Node {
  addStage(): void
}

Node --> ff_node

class ff_node {
}

class ff_farm {
}

package Operators {

  abstract class BaseOperator {
    +=(): BaseOperator
  }

  class CountOperator {
  }

  class LimitOperator {
  }

  class MapOperator {
  }

  class LinesFromFileOperator {
  }
}

CountOperator --|> BaseOperator
LimitOperator --|> BaseOperator
LinesFromFileOperator --|> BaseOperator
MapOperator --|> BaseOperator

package Stages {

  interface Stage {
  }

  class BaseStage<TOperator, bool> {
    addOperator(): void
  }

  class CollectorStage<TOperator> {
    value(): Value
    -combineWorkersResults(): void
  }
}

BaseStage .|> Stage

BaseStage --> "operators\n1..*" BaseOperator 

CollectorStage --|> BaseStage

PipeManager *-- "0..*" Stage


@enduml
